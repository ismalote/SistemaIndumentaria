-- Table: CLIENTE
CREATE TABLE CLIENTE (
    codigoCliente int NOT NULL AUTO_INCREMENT,    
	dni long NOT NULL,
    nombre varchar(255) NOT NULL,
	estado varchar(3) NOT NULL,
    CONSTRAINT CLIENTE_pk PRIMARY KEY (codigoCliente)
);

-- Table: MATERIAL
CREATE TABLE MATERIAL (
    codigoMaterial int NOT NULL AUTO_INCREMENT,
    nombreMaterial varchar(255) NOT NULL,
	estado varchar(3) NOT NULL,
    stock int NOT NULL,
    puntoPedido int NOT NULL,
    costo float NOT NULL,
    PROVEEDOR_cuit varchar(255) NOT NULL,
    CONSTRAINT MATERIAL_pk PRIMARY KEY (codigoMaterial)
);

-- Table: MATERIAL_ITEM
CREATE TABLE MATERIAL_ITEM (
    PRENDA_codigoPrenda int NOT NULL,
    MATERIAL_codigoMaterial int NOT NULL,
    cantidad int NOT NULL,
    CONSTRAINT MATERIAL_ITEM_pk PRIMARY KEY (PRENDA_codigoPrenda,MATERIAL_codigoMaterial)
);

-- Table: PRENDA
CREATE TABLE PRENDA (
    codigoPrenda int NOT NULL AUTO_INCREMENT,
    nombrePrenda varchar(255) NOT NULL,
	stock int NOT NULL,
	estado varchar(3) NOT NULL,
    CONSTRAINT PRENDA_pk PRIMARY KEY (codigoPrenda)
);

-- Table: PRENDA_CONJUNTO
CREATE TABLE PRENDA_CONJUNTO (
    PRENDA_codigoPrenda int NOT NULL,
    descuento float NOT NULL,
    CONSTRAINT PRENDA_CONJUNTO_pk PRIMARY KEY (PRENDA_codigoPrenda)
);

-- Table: PRENDA_CONJUNTO_ITEM
CREATE TABLE PRENDA_CONJUNTO_ITEM (
    PRENDA_CONJUNTO_PRENDA_codigoPrenda int NOT NULL,
    PRENDA_codigoPrenda int NOT NULL,
    CONSTRAINT PRENDA_CONJUNTO_ITEM_pk PRIMARY KEY (PRENDA_CONJUNTO_PRENDA_codigoPrenda,PRENDA_codigoPrenda)
);

-- Table: PRENDA_SIN_TEMPORADA
CREATE TABLE PRENDA_SIN_TEMPORADA (
    PRENDA_codigoPrenda int NOT NULL,
    CONSTRAINT PRENDA_SIN_TEMPORADA_pk PRIMARY KEY (PRENDA_codigoPrenda)
);

-- Table: PRENDA_TEMPORADA
CREATE TABLE PRENDA_TEMPORADA (
    PRENDA_codigoPrenda int NOT NULL,
    porcentajeIncremento float NOT NULL,
    TEMPORADA_codigoTemporada int NOT NULL,
    CONSTRAINT PRENDA_TEMPORADA_pk PRIMARY KEY (PRENDA_codigoPrenda)
);

-- Table: PROVEEDOR
CREATE TABLE PROVEEDOR (
    cuit varchar(255) NOT NULL,
    razonSocial varchar(255) NOT NULL,
	estado varchar(3) NOT NULL,
    CONSTRAINT PROVEEDOR_pk PRIMARY KEY (cuit)
);

-- Table: TEMPORADA
CREATE TABLE TEMPORADA (
    codigoTemporada int NOT NULL AUTO_INCREMENT,
    nombreTemporada varchar(255) NOT NULL,
    fechaFinalizacion timestamp NOT NULL,
    CONSTRAINT TEMPORADA_pk PRIMARY KEY (codigoTemporada)
);

-- Table: VENTA
CREATE TABLE VENTA (
    nroVenta int NOT NULL AUTO_INCREMENT,
    fecha timestamp NOT NULL,
    CLIENTE_codigoCliente int NOT NULL,
    CONSTRAINT VENTA_pk PRIMARY KEY (nroVenta)
);

-- Table: VENTA_ITEM
CREATE TABLE VENTA_ITEM (
    PRENDA_codigoPrenda int NOT NULL,
    VENTA_nroVenta int NOT NULL,
	cantidad int NOT NULL,
    CONSTRAINT VENTA_ITEM_pk PRIMARY KEY (PRENDA_codigoPrenda,VENTA_nroVenta)
);

-- foreign keys
-- Reference: MATERIAL_ITEM_MATERIAL (table: MATERIAL_ITEM)
ALTER TABLE MATERIAL_ITEM ADD CONSTRAINT MATERIAL_ITEM_MATERIAL FOREIGN KEY (MATERIAL_codigoMaterial)
    REFERENCES MATERIAL (codigoMaterial);

-- Reference: MATERIAL_PROVEEDOR (table: MATERIAL)
ALTER TABLE MATERIAL ADD CONSTRAINT MATERIAL_PROVEEDOR FOREIGN KEY (PROVEEDOR_cuit)
    REFERENCES PROVEEDOR (cuit);

-- Reference: PRENDA_CONJUNTO_ITEM_PRENDA (table: PRENDA_CONJUNTO_ITEM)
ALTER TABLE PRENDA_CONJUNTO_ITEM ADD CONSTRAINT PRENDA_CONJUNTO_ITEM_PRENDA FOREIGN KEY (PRENDA_codigoPrenda)
    REFERENCES PRENDA (codigoPrenda);

-- Reference: PRENDA_CONJUNTO_ITEM_PRENDA_CONJUNTO (table: PRENDA_CONJUNTO_ITEM)
ALTER TABLE PRENDA_CONJUNTO_ITEM ADD CONSTRAINT PRENDA_CONJUNTO_ITEM_PRENDA_CONJUNTO FOREIGN KEY (PRENDA_CONJUNTO_PRENDA_codigoPrenda)
    REFERENCES PRENDA_CONJUNTO (PRENDA_codigoPrenda);

-- Reference: PRENDA_CONJUNTO_PRENDA (table: PRENDA_CONJUNTO)
ALTER TABLE PRENDA_CONJUNTO ADD CONSTRAINT PRENDA_CONJUNTO_PRENDA FOREIGN KEY (PRENDA_codigoPrenda)
    REFERENCES PRENDA (codigoPrenda);

-- Reference: PRENDA_ITEM_PRENDA (table: MATERIAL_ITEM)
ALTER TABLE MATERIAL_ITEM ADD CONSTRAINT PRENDA_ITEM_PRENDA FOREIGN KEY (PRENDA_codigoPrenda)
    REFERENCES PRENDA (codigoPrenda);

-- Reference: PRENDA_SIN_TEMPORADA_PRENDA (table: PRENDA_SIN_TEMPORADA)
ALTER TABLE PRENDA_SIN_TEMPORADA ADD CONSTRAINT PRENDA_SIN_TEMPORADA_PRENDA FOREIGN KEY (PRENDA_codigoPrenda)
    REFERENCES PRENDA (codigoPrenda);

-- Reference: PRENDA_TEMPORADA_PRENDA (table: PRENDA_TEMPORADA)
ALTER TABLE PRENDA_TEMPORADA ADD CONSTRAINT PRENDA_TEMPORADA_PRENDA FOREIGN KEY (PRENDA_codigoPrenda)
    REFERENCES PRENDA (codigoPrenda);

-- Reference: PRENDA_TEMPORADA_TEMPORADA (table: PRENDA_TEMPORADA)
ALTER TABLE PRENDA_TEMPORADA ADD CONSTRAINT PRENDA_TEMPORADA_TEMPORADA FOREIGN KEY (TEMPORADA_codigoTemporada)
    REFERENCES TEMPORADA (codigoTemporada);

-- Reference: VENTA_CLIENTE (table: VENTA)
ALTER TABLE VENTA ADD CONSTRAINT VENTA_CLIENTE FOREIGN KEY (CLIENTE_codigoCliente)
    REFERENCES CLIENTE (codigoCliente);

-- Reference: VENTA_ITEM_PRENDA (table: VENTA_ITEM)
ALTER TABLE VENTA_ITEM ADD CONSTRAINT VENTA_ITEM_PRENDA FOREIGN KEY (PRENDA_codigoPrenda)
    REFERENCES PRENDA (codigoPrenda);

-- Reference: VENTA_ITEM_VENTA (table: VENTA_ITEM)
ALTER TABLE VENTA_ITEM ADD CONSTRAINT VENTA_ITEM_VENTA FOREIGN KEY (VENTA_nroVenta)
    REFERENCES VENTA (nroVenta);


-- COMANDOS SQL SERVER
--
--	OBTIENE EL ULTIMO ID DEL IDENTITY INSERTADO
--
--SELECT IDENT_CURRENT('MyTable')
-- O
--SELECT SCOPE_IDENTITY()
